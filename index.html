<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#EC0016">
    <title>Signalbuch Lern-App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #EC0016;
            --primary-dark: #C8102E;
            --bg: #f5f5f5;
            --card-bg: white;
            --text: #1a1a1a;
            --text-secondary: #666;
            --border: #e0e0e0;
            --shadow: rgba(0,0,0,0.1);
        }

        body.dark-mode {
            --bg: #1a1a1a;
            --card-bg: #2a2a2a;
            --text: #ffffff;
            --text-secondary: #aaa;
            --border: #3a3a3a;
            --shadow: rgba(0,0,0,0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        /* Header */
        header {
            background: var(--card-bg);
            padding: max(env(safe-area-inset-top), 15px) 20px 15px;
            box-shadow: 0 2px 10px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 1.5em;
            color: var(--primary);
            font-weight: 700;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .streak {
            background: var(--bg);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .theme-btn {
            background: var(--bg);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        main {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            padding-bottom: calc(env(safe-area-inset-bottom) + 110px);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Cards */
        .card-container {
            position: relative;
            width: 100%;
            height: 450px;
            margin: 20px 0;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            user-select: none;
            touch-action: none;
            overflow-y: auto;
        }

        .card h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--text);
            word-wrap: break-word;
            hyphens: auto;
        }

        .card h2.auto-size {
            font-size: clamp(1.2em, 5vw, 2.5em);
            line-height: 1.2;
        }

        .card h3 {
            color: var(--primary);
            font-size: 1.3em;
            margin: 15px 0 10px;
        }

        .card p {
            font-size: 1.05em;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* Reactions */
        .reactions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .reaction-btn {
            background: var(--card-bg);
            border: 2px solid var(--border);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.8em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .reaction-btn:active {
            transform: scale(1.2);
            border-color: var(--primary);
        }

        /* Progress Dots */
        .progress-dots {
            display: none; /* Unsichtbar gemacht */
            gap: 8px;
            justify-content: center;
            margin: 20px 0;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
        }

        .dot.active {
            background: var(--primary);
            width: 24px;
            border-radius: 4px;
        }

        /* Quiz/Content Card */
        .content-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 20px;
        }

        .content-card h2 {
            color: var(--text);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
            transition: transform 0.2s;
            box-shadow: 0 4px 12px rgba(236, 0, 22, 0.3);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border: 2px solid var(--border);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        /* Progress Bar */
        .progress-bar {
            background: var(--border);
            border-radius: 10px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            height: 100%;
            transition: width 0.5s;
            border-radius: 10px;
        }

        /* Search */
        .search-input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 1em;
            margin-bottom: 20px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-result {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .search-result strong {
            color: var(--primary);
            font-size: 1.2em;
            display: block;
            margin-bottom: 10px;
        }

        /* Navigation */
        nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            padding-bottom: max(env(safe-area-inset-bottom), 8px);
            box-shadow: 0 -2px 10px var(--shadow);
            z-index: 100;
        }

        nav button {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 500;
            flex: 1;
            transition: color 0.2s;
        }

        nav button span:first-child {
            font-size: 24px;
        }

        nav button.active {
            color: var(--primary);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-box .label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Info Text */
        .info {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
            margin: 15px 0;
            padding: 10px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <h1>🚂 Signalbuch</h1>
        <div class="header-right">
            <div class="streak">🔥 <span id="streakCount">5</span></div>
            <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">🌙</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Lernkarten Page -->
        <div id="page-cards" class="page active">
            <div class="container">
                <div class="card-container">
                    <div class="card" id="card">
                        <h2 id="cardTitle"></h2>
                        <div id="cardContent"></div>
                    </div>
                </div>

                <div class="progress-dots" id="progressDots"></div>

                <div class="reactions">
                    <button class="reaction-btn" onclick="handleReaction('hard')">😓</button>
                    <button class="reaction-btn" onclick="handleReaction('easy')">😊</button>
                </div>

                <p class="info">👆 Karte antippen zum Umdrehen<br>👈 Nach links/rechts wischen zum Weiterblättern 👉</p>
            </div>
        </div>

        <!-- Quiz Page -->
        <div id="page-quiz" class="page">
            <div class="container" id="quizContent">
                <div class="content-card">
                    <h2>🎯 Quiz</h2>
                    <p style="margin: 20px 0;">Teste dein Wissen mit Multiple-Choice Fragen!</p>
                    <button class="btn" onclick="startQuiz()">Quiz starten</button>
                </div>
            </div>
        </div>

        <!-- Prüfung Page -->
        <div id="page-exam" class="page">
            <div class="container" id="examContent">
                <div class="content-card">
                    <h2>✅ Prüfung</h2>
                    <p style="margin: 20px 0;">Simuliere die echte Prüfungssituation. Du benötigst 80% zum Bestehen.</p>
                    <div class="stats">
                        <div class="stat-box">
                            <div class="number">8</div>
                            <div class="label">Fragen</div>
                        </div>
                        <div class="stat-box">
                            <div class="number">80%</div>
                            <div class="label">Minimum</div>
                        </div>
                        <div class="stat-box">
                            <div class="number">⏱️</div>
                            <div class="label">Unbegrenzt</div>
                        </div>
                    </div>
                    <button class="btn" onclick="startExam()">Prüfung starten</button>
                </div>
            </div>
        </div>

        <!-- Fortschritt Page -->
        <div id="page-progress" class="page">
            <div class="container">
                <div class="content-card">
                    <h2>📈 Lernfortschritt</h2>

                    <div class="stats">
                        <div class="stat-box">
                            <div class="number" id="todayCards">12</div>
                            <div class="label">Heute</div>
                        </div>
                        <div class="stat-box">
                            <div class="number" id="streakDays">5</div>
                            <div class="label">Streak</div>
                        </div>
                        <div class="stat-box">
                            <div class="number" id="totalCards">247</div>
                            <div class="label">Gesamt</div>
                        </div>
                    </div>

                    <h3 style="margin: 30px 0 15px;">Gesamtfortschritt</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 75%"></div>
                    </div>
                    <p style="text-align: center; font-size: 1.5em; font-weight: 700; color: var(--primary);" id="progressPercent">75%</p>
                </div>
            </div>
        </div>

        <!-- Suche Page -->
        <div id="page-search" class="page">
            <div class="container">
                <input type="text" class="search-input" id="searchInput" placeholder="🔍 Suche nach Begriffen..." oninput="handleSearch()">
                <div id="searchResults"></div>
            </div>
        </div>
    </main>

    <!-- Navigation -->
    <nav>
        <button onclick="showPage('cards')" id="nav-cards" class="active">
            <span>📚</span>
            <span>Karten</span>
        </button>
        <button onclick="showPage('quiz')" id="nav-quiz">
            <span>❓</span>
            <span>Quiz</span>
        </button>
        <button onclick="showPage('exam')" id="nav-exam">
            <span>✅</span>
            <span>Prüfung</span>
        </button>
        <button onclick="showPage('progress')" id="nav-progress">
            <span>📈</span>
            <span>Fortschritt</span>
        </button>
        <button onclick="showPage('search')" id="nav-search">
            <span>🔍</span>
            <span>Suche</span>
        </button>
    </nav>
    <div style="position: fixed; bottom: 0; left: 0; right: 0; text-align: center; padding: 5px; padding-bottom: max(env(safe-area-inset-bottom), 5px); background: var(--bg); color: var(--text-secondary); font-size: 0.7em; z-index: 99;">
        Version 1.2.1
    </div>

    <script>
        // ==================== DATA ====================
        const cards = [
            // Grundbegriffe
            {
                term: "Signal",
                definition: "<h3>Signal</h3><p>Ein sichtbares oder hörbares Zeichen mit einer festgelegten Information zur Gewährleistung des sicheren Bewegens von Eisenbahnfahrzeugen.</p>",
                quiz: {
                    question: "Was ist ein Signal?",
                    answers: [
                        "Ein sichtbares oder hörbares Zeichen zur Gewährleistung der Sicherheit",
                        "Ein elektronisches Gerät zur Kommunikation",
                        "Eine Notfallausrüstung",
                        "Ein Werkzeug zur Gleisreparatur"
                    ],
                    correct: 0
                }
            },

            // Hp-Signale (Hauptsignale)
            {
                term: "Hp 0",
                image: "image/Hp_0.png",
                definition: "<h3>Hp 0 - Halt</h3><p><strong>Formsignal:</strong> Ein Signalflügel zeigt waagerecht nach rechts.</p><p><strong>Lichtsignal:</strong> Ein rotes Licht oder zwei rote Lichter nebeneinander.</p><p><strong>Bedeutung:</strong> Halt - Der Zug muss vor dem Signal anhalten. Gilt für Zug- und Rangierfahrten.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Hp 0?",
                    answers: [
                        "Halt - Der Zug muss vor dem Signal anhalten",
                        "Langsame Fahrt erlaubt",
                        "Fahrt frei mit Höchstgeschwindigkeit",
                        "Vorsicht, Bahnübergang"
                    ],
                    correct: 0
                }
            },
            {
                term: "Hp 1",
                definition: "<h3>Hp 1 - Fahrt</h3><p><strong>Formsignal:</strong> Ein Signalflügel zeigt schräg nach rechts aufwärts.</p><p><strong>Lichtsignal:</strong> Ein grünes Licht.</p><p><strong>Bedeutung:</strong> Fahrt - Fahrt mit der im Fahrplan zugelassenen Geschwindigkeit, sofern sie nicht durch andere Signale oder besondere Anordnungen eingeschränkt ist.</p>",
                quiz: {
                    question: "Welche Farbe zeigt das Lichtsignal Hp 1?",
                    answers: [
                        "Rot",
                        "Gelb",
                        "Grün",
                        "Weiß"
                    ],
                    correct: 2
                }
            },
            {
                term: "Hp 2",
                definition: "<h3>Hp 2 - Langsamfahrt</h3><p><strong>Formsignal:</strong> Zwei Signalflügel zeigen schräg nach rechts aufwärts.</p><p><strong>Lichtsignal:</strong> Ein grünes und senkrecht darunter ein gelbes Licht.</p><p><strong>Bedeutung:</strong> Langsamfahrt - Geschwindigkeitsbeschränkung auf 40 km/h (oder durch Zs 3 angezeigte Geschwindigkeit) im anschließenden Weichenbereich.</p>",
                quiz: {
                    question: "Auf welche Geschwindigkeit muss bei Hp 2 reduziert werden?",
                    answers: [
                        "60 km/h",
                        "50 km/h",
                        "40 km/h",
                        "30 km/h"
                    ],
                    correct: 2
                }
            },

            // Vr-Signale (Vorsignale)
            {
                term: "Vr 0",
                definition: "<h3>Vr 0 - Halt erwarten</h3><p><strong>Formsignal:</strong> Die runde Scheibe steht senkrecht, Flügel zeigt senkrecht nach unten.</p><p><strong>Lichtsignal:</strong> Zwei gelbe Lichter nach rechts steigend.</p><p><strong>Bedeutung:</strong> Halt erwarten - Kündigt an, dass am zugehörigen Hauptsignal Halt zu erwarten ist.</p>",
                quiz: {
                    question: "Was kündigt das Signal Vr 0 an?",
                    answers: [
                        "Freie Fahrt am nächsten Hauptsignal",
                        "Halt am zugehörigen Hauptsignal",
                        "Langsamfahrt am nächsten Signal",
                        "Ende der Geschwindigkeitsbegrenzung"
                    ],
                    correct: 1
                }
            },
            {
                term: "Vr 1",
                definition: "<h3>Vr 1 - Fahrt erwarten</h3><p><strong>Formsignal:</strong> Die runde Scheibe liegt waagerecht.</p><p><strong>Lichtsignal:</strong> Zwei grüne Lichter nach rechts steigend.</p><p><strong>Bedeutung:</strong> Fahrt erwarten - Kündigt an, dass am zugehörigen Hauptsignal Fahrt zu erwarten ist.</p>",
                quiz: {
                    question: "Welche Farbe zeigt das Lichtsignal Vr 1?",
                    answers: [
                        "Zwei rote Lichter",
                        "Zwei gelbe Lichter",
                        "Zwei grüne Lichter",
                        "Ein grünes und ein gelbes Licht"
                    ],
                    correct: 2
                }
            },
            {
                term: "Vr 2",
                definition: "<h3>Vr 2 - Langsamfahrt erwarten</h3><p><strong>Formsignal:</strong> Die runde Scheibe steht senkrecht, der Flügel zeigt schräg nach rechts abwärts.</p><p><strong>Lichtsignal:</strong> Ein gelbes Licht und nach rechts steigend ein grünes Licht.</p><p><strong>Bedeutung:</strong> Langsamfahrt erwarten - Kündigt an, dass am zugehörigen Hauptsignal Langsamfahrt zu erwarten ist.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Vr 2?",
                    answers: [
                        "Halt erwarten",
                        "Fahrt erwarten",
                        "Langsamfahrt erwarten",
                        "Geschwindigkeitserhöhung"
                    ],
                    correct: 2
                }
            },

            // Ks-Signale (Kombinationssignale)
            {
                term: "Ks 1",
                definition: "<h3>Ks 1 - Fahrt</h3><p><strong>Beschreibung:</strong> Ein grünes Licht bzw. ein grünes Blinklicht.</p><p><strong>Bedeutung:</strong> Fahrt - Am Hauptsignal: Anwendung der im Fahrplan zugelassenen Geschwindigkeit. Das Signal blinkt, wenn zusätzlich ein Zs 3v gezeigt wird.</p>",
                quiz: {
                    question: "Was bedeutet ein blinkendes grünes Licht bei Ks 1?",
                    answers: [
                        "Sofort anhalten",
                        "Es wird zusätzlich ein Zs 3v gezeigt",
                        "Fahrt in Gegenrichtung",
                        "Störung des Signals"
                    ],
                    correct: 1
                }
            },
            {
                term: "Ks 2",
                definition: "<h3>Ks 2 - Halt erwarten</h3><p><strong>Beschreibung:</strong> Ein gelbes Licht.</p><p><strong>Bedeutung:</strong> Halt erwarten - Die Vorbeifahrt ist erlaubt und kündigt Halt am nächsten Signal an.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Ks 2?",
                    answers: [
                        "Sofort halten",
                        "Halt erwarten am nächsten Signal",
                        "Fahrt frei",
                        "Langsamfahrt"
                    ],
                    correct: 1
                }
            },

            // Hl-Signale
            {
                term: "Hl 1",
                definition: "<h3>Hl 1 - Fahrt mit Höchstgeschwindigkeit</h3><p><strong>Beschreibung:</strong> Ein grünes Licht.</p><p><strong>Bedeutung:</strong> Fahrt mit Höchstgeschwindigkeit.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Hl 1?",
                    answers: [
                        "Fahrt mit 100 km/h",
                        "Fahrt mit Höchstgeschwindigkeit",
                        "Fahrt mit 40 km/h",
                        "Halt erwarten"
                    ],
                    correct: 1
                }
            },
            {
                term: "Hl 10",
                definition: "<h3>Hl 10 - Halt erwarten</h3><p><strong>Beschreibung:</strong> Ein gelbes Licht.</p><p><strong>Bedeutung:</strong> Halt erwarten.</p>",
                quiz: {
                    question: "Welche Farbe zeigt das Signal Hl 10?",
                    answers: [
                        "Grün",
                        "Rot",
                        "Gelb",
                        "Weiß"
                    ],
                    correct: 2
                }
            },

            // Zs-Signale (Zusatzsignale)
            {
                term: "Zs 1 - Ersatzsignal",
                definition: "<h3>Zs 1 - Ersatzsignal</h3><p><strong>Beschreibung:</strong> Drei weiße Lichter in Form eines A oder ein weißes Blinklicht.</p><p><strong>Bedeutung:</strong> Am Signal Hp 0 oder am gestörten Lichthauptsignal ohne schriftlichen Befehl vorbeifahren.</p>",
                quiz: {
                    question: "Was erlaubt das Ersatzsignal Zs 1?",
                    answers: [
                        "Sofort mit Höchstgeschwindigkeit fahren",
                        "Am Halt zeigenden Signal ohne schriftlichen Befehl vorbeifahren",
                        "Rangierfahrt beginnen",
                        "In ein Stumpfgleis einfahren"
                    ],
                    correct: 1
                }
            },
            {
                term: "Zs 2 - Richtungsanzeiger",
                definition: "<h3>Zs 2 - Richtungsanzeiger</h3><p><strong>Beschreibung:</strong> Ein weißleuchtender Buchstabe.</p><p><strong>Bedeutung:</strong> Die Fahrstraße führt in die angezeigte Richtung (angezeigt durch Kennbuchstaben).</p>",
                quiz: {
                    question: "Was zeigt das Signal Zs 2 an?",
                    answers: [
                        "Die Geschwindigkeit",
                        "Die Richtung der Fahrstraße",
                        "Die Gleisnummer",
                        "Die Entfernung zum nächsten Bahnhof"
                    ],
                    correct: 1
                }
            },
            {
                term: "Zs 3 - Geschwindigkeitsanzeiger",
                definition: "<h3>Zs 3 - Geschwindigkeitsanzeiger</h3><p><strong>Beschreibung:</strong> Eine weiß leuchtende Kennziffer (Lichtsignal) oder weiße Kennziffer auf dreieckiger schwarzer Tafel (Formsignal).</p><p><strong>Bedeutung:</strong> Die durch die Kennziffer angezeigte Geschwindigkeit (10facher Wert in km/h) darf vom Signal ab im anschließenden Weichenbereich nicht überschritten werden.</p>",
                quiz: {
                    question: "Was bedeutet die Kennziffer '6' beim Signal Zs 3?",
                    answers: [
                        "6 km/h",
                        "16 km/h",
                        "60 km/h",
                        "600 m bis zum nächsten Signal"
                    ],
                    correct: 2
                }
            },
            {
                term: "Zs 3v - Geschwindigkeitsvoranzeiger",
                definition: "<h3>Zs 3v - Geschwindigkeitsvoranzeiger</h3><p><strong>Beschreibung:</strong> Eine gelbleuchtende Kennziffer.</p><p><strong>Bedeutung:</strong> Geschwindigkeitsanzeiger (Zs 3) erwarten. Die Kennziffer bedeutet 10facher Wert in km/h.</p>",
                quiz: {
                    question: "Welche Farbe hat die Kennziffer beim Zs 3v?",
                    answers: [
                        "Weiß",
                        "Grün",
                        "Gelb",
                        "Rot"
                    ],
                    correct: 2
                }
            },
            {
                term: "Zs 6 - Gegengleisanzeiger",
                definition: "<h3>Zs 6 - Gegengleisanzeiger</h3><p><strong>Beschreibung:</strong> Ein weiß leuchtender schräger Lichtstreifen mit senkrecht abgebogenen Enden.</p><p><strong>Bedeutung:</strong> Der Fahrweg führt in das Streckengleis entgegen der gewöhnlichen Fahrtrichtung.</p>",
                quiz: {
                    question: "Was zeigt das Signal Zs 6 an?",
                    answers: [
                        "Ende der Geschwindigkeitsbegrenzung",
                        "Fahrt in das Gegengleis",
                        "Bahnübergang voraus",
                        "Rangierverbot"
                    ],
                    correct: 1
                }
            },
            {
                term: "Zs 7 - Vorsichtsignal",
                definition: "<h3>Zs 7 - Vorsichtsignal</h3><p><strong>Beschreibung:</strong> Drei gelbe Lichter in Form eines V.</p><p><strong>Bedeutung:</strong> Am Signal Hp 0 oder am gestörten Lichthauptsignal ohne schriftlichen Befehl vorbeifahren! Weiterfahrt auf Sicht bis zum nächsten Hauptsignal.</p>",
                quiz: {
                    question: "Wie muss nach dem Vorsichtsignal Zs 7 weitergefahren werden?",
                    answers: [
                        "Mit Höchstgeschwindigkeit",
                        "Mit 40 km/h",
                        "Auf Sicht bis zum nächsten Hauptsignal",
                        "Mit Schrittgeschwindigkeit"
                    ],
                    correct: 2
                }
            },
            {
                term: "Zs 10 - Endesignal",
                definition: "<h3>Zs 10 - Endesignal</h3><p><strong>Beschreibung:</strong> Ein weißleuchtender Pfeil mit der Spitze nach oben.</p><p><strong>Bedeutung:</strong> Ende der Geschwindigkeitsbeschränkung - Eine mit Hp 2 oder Zs 3 vorgeschriebene Geschwindigkeitsbeschränkung ist bereits vor dem Ende des anschließenden Weichenbereichs aufgehoben.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Zs 10?",
                    answers: [
                        "Geschwindigkeitsbeschränkung beginnt",
                        "Ende der Geschwindigkeitsbeschränkung",
                        "Halt am nächsten Signal",
                        "Rangierfahrt erlaubt"
                    ],
                    correct: 1
                }
            },

            // Sh-Signale (Schutzsignale)
            {
                term: "Sh 0",
                definition: "<h3>Sh 0 - Halt! Fahrverbot</h3><p><strong>Beschreibung:</strong> Ein waagerechter schwarzer Streifen in runder weißer Scheibe auf schwarzem Grund.</p><p><strong>Bedeutung:</strong> Halt! Fahrverbot - Bei Gleiswaagen und Drehscheiben: dürfen nicht befahren werden. Gleissperrensignal: Gleissperre ist aufgelegt.</p>",
                quiz: {
                    question: "Was bedeutet das Signal Sh 0?",
                    answers: [
                        "Langsam fahren",
                        "Halt! Fahrverbot",
                        "Rangieren erlaubt",
                        "Fahrt frei"
                    ],
                    correct: 1
                }
            },
            {
                term: "Sh 1 - Rangierfahrtsignal",
                definition: "<h3>Sh 1 - Fahrverbot aufgehoben</h3><p><strong>Formsignal:</strong> Ein nach rechts steigender schwarzer Streifen auf runder weißer Scheibe.</p><p><strong>Lichtsignal:</strong> Zwei weiße Lichter nach rechts steigend.</p><p><strong>Bedeutung:</strong> Fahrverbot aufgehoben. In Verbindung mit Hp 0: Haltegebot für Rangierfahrten aufgehoben.</p>",
                quiz: {
                    question: "Wofür wird das Signal Sh 1 verwendet?",
                    answers: [
                        "Fahrverbot aufheben für Rangierfahrten",
                        "Halt anzeigen",
                        "Geschwindigkeit begrenzen",
                        "Richtung anzeigen"
                    ],
                    correct: 0
                }
            },
            {
                term: "Sh 2 - Schutzhalt",
                definition: "<h3>Sh 2 - Schutzhalt</h3><p><strong>Tageszeichen:</strong> Eine rechteckige rote Scheibe mit weißem Rand.</p><p><strong>Nachtzeichen:</strong> Ein rotes Licht.</p><p><strong>Bedeutung:</strong> Schutzhalt - Kennzeichnung einer Stelle, die nicht befahren werden darf (z.B. Wärterhaltscheibe oder Abschlusssignal eines Stumpfgleises).</p>",
                quiz: {
                    question: "Welche Farbe hat die Scheibe beim Signal Sh 2?",
                    answers: [
                        "Weiß mit rotem Rand",
                        "Rot mit weißem Rand",
                        "Gelb mit schwarzem Rand",
                        "Grün mit weißem Rand"
                    ],
                    correct: 1
                }
            },
            {
                term: "Sh 3 - Kreissignal",
                definition: "<h3>Sh 3 - Sofort halten</h3><p><strong>Tageszeichen:</strong> Eine rot-weiße Signalfahne, ein Gegenstand oder der Arm wird im Kreis geschwungen.</p><p><strong>Nachtzeichen:</strong> Eine Laterne (möglichst rot abgeblendet) wird im Kreis geschwungen.</p><p><strong>Bedeutung:</strong> Sofort halten - Wird gegeben, wenn ein Zug oder eine Rangierfahrt sofort zum Halten gebracht werden muss.</p>",
                quiz: {
                    question: "Wann wird das Signal Sh 3 gegeben?",
                    answers: [
                        "Bei normaler Einfahrt",
                        "Wenn sofort gehalten werden muss",
                        "Bei Langsamfahrt",
                        "Bei Rangierfahrten"
                    ],
                    correct: 1
                }
            },

            // Ra-Signale (Rangiersignale)
            {
                term: "Ra 1 - Wegfahren",
                definition: "<h3>Ra 1 - Wegfahren</h3><p><strong>Beschreibung:</strong> Mundpfeife/Horn: Ein langer Ton. Arm: Senkrechte Bewegung von oben nach unten.</p><p><strong>Bedeutung:</strong> Wegfahren - Die Rangierfahrt soll in Richtung vom Signalgeber wegfahren.</p>",
                quiz: {
                    question: "Wie viele Töne hat das akustische Signal Ra 1?",
                    answers: [
                        "Drei kurze Töne",
                        "Zwei lange Töne",
                        "Ein langer Ton",
                        "Vier kurze Töne"
                    ],
                    correct: 2
                }
            },
            {
                term: "Ra 2 - Herkommen",
                definition: "<h3>Ra 2 - Herkommen</h3><p><strong>Beschreibung:</strong> Mundpfeife/Horn: Zwei mäßig lange Töne. Arm: Langsame waagerechte Bewegung hin und her.</p><p><strong>Bedeutung:</strong> Herkommen - Die Rangierfahrt soll in Richtung auf den Signalgeber zu fahren.</p>",
                quiz: {
                    question: "Wie viele Töne hat das akustische Signal Ra 2?",
                    answers: [
                        "Ein langer Ton",
                        "Zwei mäßig lange Töne",
                        "Drei kurze Töne",
                        "Vier Töne"
                    ],
                    correct: 1
                }
            },
            {
                term: "Ra 5 - Rangierhalt",
                definition: "<h3>Ra 5 - Rangierhalt</h3><p><strong>Beschreibung:</strong> Mundpfeife/Horn: Drei kurze Töne schnell nacheinander. Arm: Kreisförmige Bewegung des Arms.</p><p><strong>Bedeutung:</strong> Rangierhalt - Das Signal gilt bereits, wenn es nur hörbar oder nur sichtbar aufgenommen wird.</p>",
                quiz: {
                    question: "Wie wird das Signal Ra 5 akustisch gegeben?",
                    answers: [
                        "Ein langer Ton",
                        "Zwei lange Töne",
                        "Drei kurze Töne schnell nacheinander",
                        "Vier kurze Töne"
                    ],
                    correct: 2
                }
            },
            {
                term: "Ra 10 - Rangierhalttafel",
                definition: "<h3>Ra 10 - Rangierhalttafel</h3><p><strong>Beschreibung:</strong> Eine oben halbkreisförmig abgerundete weiße Tafel mit schwarzer Aufschrift 'Halt für Rangierfahrten'.</p><p><strong>Bedeutung:</strong> Über die Tafel hinaus darf nicht rangiert werden.</p>",
                quiz: {
                    question: "Was bedeutet die Rangierhalttafel Ra 10?",
                    answers: [
                        "Rangieren mit Schrittgeschwindigkeit",
                        "Über die Tafel hinaus darf nicht rangiert werden",
                        "Rangieren nur mit Genehmigung",
                        "Ende des Rangierbereichs"
                    ],
                    correct: 1
                }
            },
            {
                term: "Ra 12 - Grenzzeichen",
                definition: "<h3>Ra 12 / So 12 - Grenzzeichen</h3><p><strong>Beschreibung:</strong> Ein rot-weißes Zeichen.</p><p><strong>Bedeutung:</strong> Grenze, bis zu der bei zusammenlaufenden Gleisen das Gleis besetzt werden darf.</p>",
                quiz: {
                    question: "Was zeigt das Grenzzeichen Ra 12 an?",
                    answers: [
                        "Geschwindigkeitsgrenze",
                        "Grenze für Gleisbesetzung bei zusammenlaufenden Gleisen",
                        "Landesgrenze",
                        "Grenze des Bahnhofs"
                    ],
                    correct: 1
                }
            },

            // Lf-Signale
            {
                term: "Lf 1 - Langsamfahrscheibe",
                definition: "<h3>Lf 1 - Langsamfahrscheibe</h3><p><strong>Tageszeichen:</strong> Eine auf der Spitze stehende dreieckige gelbe Scheibe mit weißem Rand zeigt eine schwarze Kennziffer.</p><p><strong>Nachtzeichen:</strong> Unter dem beleuchteten Tageszeichen zwei schräg nach links steigende gelbe Lichter.</p><p><strong>Bedeutung:</strong> Es folgt eine vorübergehende Langsamfahrstelle (Kennziffer x 10 in km/h).</p>",
                quiz: {
                    question: "Was bedeutet die Kennziffer '4' beim Signal Lf 1?",
                    answers: [
                        "4 km/h",
                        "14 km/h",
                        "40 km/h",
                        "400 m bis zur Langsamfahrstelle"
                    ],
                    correct: 2
                }
            },

            // Zp-Signale
            {
                term: "Zp 1 - Achtungssignal",
                definition: "<h3>Zp 1 - Achtungssignal</h3><p><strong>Beschreibung:</strong> Ein mäßig langer Ton (Pfeife oder Horn).</p><p><strong>Bedeutung:</strong> Achtung - Dient dazu, Aufmerksamkeit zu erregen oder zu bestätigen, dass ein Signalauftrag wahrgenommen wurde. Z.B. um Personen zu warnen oder vor nicht gesicherten Bahnübergängen.</p>",
                quiz: {
                    question: "Wofür wird das Achtungssignal Zp 1 verwendet?",
                    answers: [
                        "Nur für Notfälle",
                        "Um Aufmerksamkeit zu erregen oder Signalaufträge zu bestätigen",
                        "Nur bei Rangierfahrten",
                        "Nur bei Nacht"
                    ],
                    correct: 1
                }
            },

            // So-Signale (Sonstige Signale)
            {
                term: "So 20 - Zuordnungstafel",
                image: "image/So 20.png",
                definition: "<h3>So 20 - Zuordnungstafel</h3><p><strong>Beschreibung:</strong> Ein schwarzes Rechteck mit weißem, rückstrahlendem Dreieck.</p><p><strong>Bedeutung:</strong> Das Signal gilt für das Gleis, auf das die Spitze des Dreiecks weist.</p>",
                quiz: {
                    question: "Wofür steht die Zuordnungstafel (So 20)?",
                    answers: [
                        "Geschwindigkeitsbegrenzung",
                        "Das Signal gilt für das Gleis, auf das die Spitze des Dreiecks weist",
                        "Notsignal",
                        "Haltesignal"
                    ],
                    correct: 1
                }
            },

            // Mastschilder
            {
                term: "Weiß-rot-weißes Mastschild",
                image: "image/Weiß-rot-weißes_Mastschild.svg.png",
                definition: "<h3>Weiß-rot-weißes Mastschild</h3><p>An einem durch ein weiß-rot-weißes Mastschild bzw. durch ein Mastschild mit einem mit der Spitze nach oben weisenden roten Dreieck auf weißem Grund (DV 301) gekennzeichneten Lichtsignal, das Halt zeigt oder gestört ist, dürfen Züge nur auf Ersatzsignal, Vorsichtsignal, Gegengleisfahrt-Ersatzsignal, Befehl oder – bei Signal Zs 12 – auf mündlichen bzw. fernmündlichen Auftrag vorbeifahren.</p><p><strong>Rangierfahrten:</strong> Dürfen nur mit Zustimmung des zuständigen Wärters am Signal vorbeifahren.</p>",
                quiz: {
                    question: "Was bedeutet ein weiß-rot-weißes Mastschild am Lichtsignal?",
                    answers: [
                        "Vorbeifahrt bei gestörtem Signal ohne Zustimmung erlaubt",
                        "Vorbeifahrt nur auf Ersatzsignal, Befehl oder mündlichen Auftrag",
                        "Signal zeigt immer Fahrt frei",
                        "Rangierfahrten sind grundsätzlich verboten"
                    ],
                    correct: 1
                }
            },
            {
                term: "Weiß-gelb-weiß-gelb-weißes Mastschild",
                image: "image/Weiß-gelb-weiß-gelb-weißes_Mastschild.svg.png",
                definition: "<h3>Weiß-gelb-weiß-gelb-weißes Mastschild</h3><p><strong>Beschreibung:</strong> Abwechselnde weiße und gelbe waagerechte Felder.</p><p><strong>Bedeutung:</strong> An einem durch dieses Mastschild gekennzeichneten Lichthauptsignal, das Halt zeigt oder gestört ist, dürfen Züge, wenn nach dem Anhalten vor diesem Signal eine Verständigung mit dem Fahrdienstleiter nicht möglich ist, ohne Zustimmung vorbeifahren und müssen bis zum nächsten Hauptsignal auf Sicht fahren.</p><p><strong>Wichtig:</strong> Hauptsignale mit diesem Mastschild besitzen im Geltungsbereich der DV 301 zugleich eine Vorsignalfunktion.</p>",
                quiz: {
                    question: "Was bedeutet ein weiß-gelb-weiß-gelb-weißes Mastschild?",
                    answers: [
                        "Vorbeifahrt nur mit ausdrücklicher Zustimmung",
                        "Vorbeifahrt ohne Zustimmung möglich, wenn keine Verständigung mit dem Fdl möglich ist",
                        "Signal hat keine Bedeutung für Züge",
                        "Nur für Rangierfahrten"
                    ],
                    correct: 1
                }
            },
            {
                term: "Weiß-schwarz-weiß-schwarz-weißes Mastschild",
                image: "image/Weiß-schwarz-weiß-schwarz-weißes_Mastschild.svg.png",
                definition: "<h3>Weiß-schwarz-weiß-schwarz-weißes Mastschild</h3><p><strong>Beschreibung:</strong> Abwechselnde weiße und schwarze waagerechte Felder.</p><p><strong>Verwendung:</strong> Nur bei den Gleichstrom-S-Bahnen Berlin und Hamburg.</p><p><strong>Bedeutung:</strong> An einem durch dieses Mastschild gekennzeichneten Lichthauptsignal, das Halt zeigt oder gestört ist, dürfen Züge nach dem Anhalten vor diesem Signal ohne Zustimmung vorbeifahren und müssen bis zum nächsten Hauptsignal auf Sicht fahren.</p><p><strong>Wichtig:</strong> Hauptsignale mit diesem Mastschild besitzen zugleich eine Vorsignalfunktion.</p>",
                quiz: {
                    question: "Wo wird das weiß-schwarz-weiß-schwarz-weiße Mastschild verwendet?",
                    answers: [
                        "Deutschlandweit",
                        "Nur bei Gleichstrom-S-Bahnen Berlin und Hamburg",
                        "Nur im Fernverkehr",
                        "Nur auf Nebenstrecken"
                    ],
                    correct: 1
                }
            },
            {
                term: "Rotes Mastschild",
                image: "image/Rotes_Mastschild.svg.png",
                definition: "<h3>Rotes Mastschild</h3><p><strong>Beschreibung:</strong> Ein vollständig rotes Mastschild.</p><p><strong>Verwendung:</strong> Nur bei der Gleichstrom-S-Bahn Berlin.</p><p><strong>Bedeutung:</strong> An einem durch ein rotes Mastschild gekennzeichneten Lichthauptsignal, das Halt zeigt oder gestört ist, dürfen Züge nur auf Ersatzsignal, Gegengleisfahrt-Ersatzsignal, Befehl oder – bei Signal Zs 12 – auf mündlichen bzw. fernmündlichen Auftrag vorbeifahren.</p>",
                quiz: {
                    question: "Was ist die Besonderheit des roten Mastschilds?",
                    answers: [
                        "Es wird deutschlandweit verwendet",
                        "Es wird nur bei der Gleichstrom-S-Bahn Berlin verwendet",
                        "Es bedeutet Fahrt frei",
                        "Es kennzeichnet Bahnübergänge"
                    ],
                    correct: 1
                }
            },
            {
                term: "Weißes Mastschild mit zwei schwarzen Punkten",
                image: "image/Weißes_Mastschild_mit_zwei_schwarzen_Punkten.svg.png",
                definition: "<h3>Weißes Mastschild mit zwei schwarzen Punkten (DV 301)</h3><p><strong>Beschreibung:</strong> Ein weißes Mastschild mit zwei schwarzen Punkten übereinander.</p><p><strong>Bedeutung:</strong> An einem durch dieses Mastschild gekennzeichneten Lichtsignal, das Halt zeigt, dürfen Züge nur auf Befehl vorbeifahren.</p><p><strong>Besonderheit:</strong> Ein mit diesem Mastschild gekennzeichnetes Signal, das Ra 12 (DV 301) zeigt oder erloschen ist, hat für Züge keine Bedeutung.</p>",
                quiz: {
                    question: "Wann dürfen Züge an einem Signal mit weißem Mastschild mit zwei schwarzen Punkten vorbeifahren?",
                    answers: [
                        "Ohne Zustimmung",
                        "Nur auf Befehl",
                        "Bei Ra 12",
                        "Wenn das Signal erloschen ist"
                    ],
                    correct: 1
                }
            },
            {
                term: "Gelbes dreieckiges Mastschild (Vorsignaltafel)",
                image: "image/Gelbes_Mastschild.svg.png",
                definition: "<h3>Gelbes dreieckiges Mastschild (Vorsignaltafel)</h3><p><strong>Beschreibung:</strong> Ein dreieckiges gelbes Mastschild mit nach unten weisender Spitze.</p><p><strong>Bedeutung:</strong> Kennzeichnet die Vorsignalfunktion eines Hauptsignals.</p><p><strong>Anordnung:</strong> Das dreieckige gelbe Mastschild ist grundsätzlich unter dem Mastschild des Hauptsignals angeordnet.</p><p><strong>Wichtig:</strong> Zeigt an, dass das Signal sowohl als Hauptsignal als auch als Vorsignal für das nächste Signal fungiert.</p>",
                quiz: {
                    question: "Was kennzeichnet das gelbe dreieckige Mastschild?",
                    answers: [
                        "Ein gestörtes Signal",
                        "Die Vorsignalfunktion eines Hauptsignals",
                        "Eine Geschwindigkeitsbegrenzung",
                        "Ein Bahnübergang"
                    ],
                    correct: 1
                }
            }
        ];

        // ==================== STATE ====================
        let currentIndex = 0;
        let isFlipped = false;
        let startX = 0;
        let startY = 0;
        let isDragging = false;
        let hasMoved = false;
        let touchStartTime = 0;
        let quizQuestions = [];
        let quizIndex = 0;
        let quizScore = 0;
        let isExamMode = false;

        // ==================== INIT ====================
        const card = document.getElementById('card');
        showCard();
        updateProgressDots();
        loadProgress();

        // ==================== NAVIGATION ====================
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));

            // Show selected page
            document.getElementById('page-' + pageName).classList.add('active');
            document.getElementById('nav-' + pageName).classList.add('active');
        }

        // ==================== THEME ====================
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.getElementById('themeBtn').textContent = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Load theme
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeBtn').textContent = '☀️';
        }

        // ==================== CARDS ====================
        card.addEventListener('mousedown', handleStart);
        card.addEventListener('touchstart', handleStart, { passive: false });
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('touchmove', handleMove, { passive: false });
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchend', handleEnd);

        function handleStart(e) {
            const point = e.touches ? e.touches[0] : e;
            startX = point.clientX;
            startY = point.clientY;
            isDragging = true;
            hasMoved = false;
            touchStartTime = Date.now();
            card.style.transition = 'none';
        }

        function handleMove(e) {
            if (!isDragging) return;
            
            const point = e.touches ? e.touches[0] : e;
            const deltaX = point.clientX - startX;
            const deltaY = point.clientY - startY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

            // Markiere als bewegt, wenn mehr als 15px
            if (distance > 15) {
                hasMoved = true;
                e.preventDefault();
                const rotation = deltaX * 0.1;
                card.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${rotation}deg)`;
            }
        }

        function handleEnd(e) {
            if (!isDragging) return;
            
            const point = e.changedTouches ? e.changedTouches[0] : e;
            const deltaX = point.clientX - startX;
            const deltaY = point.clientY - startY;
            const distance = Math.abs(deltaX);
            const touchDuration = Date.now() - touchStartTime;

            card.style.transition = 'transform 0.01s';
            isDragging = false;

            // Wenn nicht bewegt wurde UND kurzer Touch (unter 100ms) -> Flip
            if (!hasMoved && touchDuration < 10) {
                card.style.transform = '';
                flipCard();
            }
            // Wenn weit genug geswiped -> nächste/vorherige Karte
            else if (hasMoved && distance > 100) {
                if (deltaX > 0) {
                    previousCard();
                } else {
                    nextCard();
                }
            }
            // Sonst zurücksetzen
            else {
                card.style.transform = '';
            }

            setTimeout(() => {
                card.style.transform = '';
                hasMoved = false;
            }, 100);
        }

        function showCard() {
            const current = cards[currentIndex];
            const titleElement = document.getElementById('cardTitle');

            if (isFlipped) {
                titleElement.textContent = '';
                titleElement.classList.remove('auto-size');
                document.getElementById('cardContent').innerHTML = current.definition;
            } else {
                // Vorderseite: Zeige Bild(er) wenn vorhanden, sonst Text
                if (current.images && current.images.length > 0) {
                    // Mehrere Bilder nebeneinander
                    titleElement.textContent = '';
                    titleElement.classList.remove('auto-size');
                    let imagesHtml = '<div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap; margin: 20px 0;">';
                    current.images.forEach(img => {
                        imagesHtml += `<img src="${img}" style="max-width: 40%; max-height: 250px; height: auto; border-radius: 10px;" alt="${current.term}">`;
                    });
                    imagesHtml += '</div>';
                    document.getElementById('cardContent').innerHTML = `
                        ${imagesHtml}
                        <p style="color: var(--text-secondary); font-style: italic; margin-top: 20px;">Karte antippen zum Umdrehen</p>
                    `;
                } else if (current.image) {
                    // Einzelnes Bild
                    titleElement.textContent = '';
                    titleElement.classList.remove('auto-size');
                    // Weißer Hintergrund für Gelbes Mastschild
                    const bgStyle = current.image.includes('Gelbes_Mastschild') ? 'background: white; padding: 10px;' : '';
                    document.getElementById('cardContent').innerHTML = `
                        <img src="${current.image}" style="max-width: 90%; max-height: 300px; height: auto; margin: 20px auto; display: block; border-radius: 10px; ${bgStyle}" alt="${current.term}">
                        <p style="color: var(--text-secondary); font-style: italic; margin-top: 20px;">Karte antippen zum Umdrehen</p>
                    `;
                } else {
                    // Kein Bild - nur Text mit dynamischer Schriftgröße
                    titleElement.textContent = current.term;
                    titleElement.classList.add('auto-size');
                    titleElement.style.fontSize = ''; // Reset font size
                    
                    // Schriftgröße automatisch anpassen
                    setTimeout(() => adjustFontSize(titleElement), 10);
                    
                    document.getElementById('cardContent').innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">Karte antippen zum Umdrehen</p>';
                }
            }

            updateProgressDots();
        }

        function adjustFontSize(element) {
            const maxHeight = 200; // Maximale Höhe für den Titel
            let fontSize = 2.5; // Start mit großer Schrift
            
            element.style.fontSize = fontSize + 'em';
            
            // Reduziere Schriftgröße, bis Text passt
            while (element.scrollHeight > maxHeight && fontSize > 1) {
                fontSize -= 0.1;
                element.style.fontSize = fontSize + 'em';
            }
        }

        function flipCard() {
            isFlipped = !isFlipped;
            showCard();

            card.style.transition = 'transform 0.2s';
            card.style.transform = 'scale(1.05)';
            setTimeout(() => card.style.transform = '', 200);

            if (navigator.vibrate) navigator.vibrate(10);
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % cards.length;
            isFlipped = false;
            
            // Elegante Fade-Out Animation
            card.style.transition = 'opacity 0.2s ease-out, transform 0.2s ease-out';
            card.style.opacity = '0';
            card.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                showCard();
                card.style.transition = 'none';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.3s ease-in, transform 0.3s ease-in';
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, 20);
            }, 200);

            saveProgress();
        }

        function previousCard() {
            currentIndex = (currentIndex - 1 + cards.length) % cards.length;
            isFlipped = false;
            
            // Elegante Fade-Out Animation
            card.style.transition = 'opacity 0.2s ease-out, transform 0.2s ease-out';
            card.style.opacity = '0';
            card.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                showCard();
                card.style.transition = 'none';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.3s ease-in, transform 0.3s ease-in';
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, 20);
            }, 200);
        }

        function handleReaction(type) {
            nextCard();
        }

        function updateProgressDots() {
            const container = document.getElementById('progressDots');
            container.innerHTML = '';

            cards.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = 'dot' + (i === currentIndex ? ' active' : '');
                container.appendChild(dot);
            });
        }

        // ==================== QUIZ ====================
        function startQuiz() {
            isExamMode = false;
            quizQuestions = [...cards].sort(() => Math.random() - 0.5);
            quizIndex = 0;
            quizScore = 0;
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const content = document.getElementById('quizContent');

            if (quizIndex >= quizQuestions.length) {
                const percent = Math.round((quizScore / quizQuestions.length) * 100);
                content.innerHTML = `
                    <div class="content-card">
                        <h2>🎯 Quiz Beendet!</h2>
                        <div class="stat-box" style="margin: 30px 0;">
                            <div class="number">${percent}%</div>
                            <div class="label">${quizScore} / ${quizQuestions.length} richtig</div>
                        </div>
                        <button class="btn" onclick="startQuiz()">Nochmal spielen</button>
                        <button class="btn btn-secondary" onclick="showPage('cards')">Zurück zu Karten</button>
                    </div>
                `;
                return;
            }

            const q = quizQuestions[quizIndex].quiz;
            let html = `
                <div class="content-card">
                    <h2>Frage ${quizIndex + 1}/${quizQuestions.length}</h2>
                    <p style="font-size: 1.2em; margin: 25px 0; font-weight: 600;">${q.question}</p>
            `;

            q.answers.forEach((answer, i) => {
                html += `<button class="btn btn-secondary" onclick="checkAnswer(${i})">${answer}</button>`;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        function checkAnswer(selected) {
            const correct = quizQuestions[quizIndex].quiz.correct === selected;

            if (correct) {
                quizScore++;
                if (!isExamMode) alert('✅ Richtig!');
            } else {
                if (!isExamMode) {
                    const correctAnswer = quizQuestions[quizIndex].quiz.answers[quizQuestions[quizIndex].quiz.correct];
                    alert(`❌ Falsch! Richtig war: ${correctAnswer}`);
                }
            }

            quizIndex++;

            if (isExamMode) {
                renderExamQuestion();
            } else {
                renderQuizQuestion();
            }
        }

        // ==================== EXAM ====================
        function startExam() {
            isExamMode = true;
            quizQuestions = [...cards].sort(() => Math.random() - 0.5);
            quizIndex = 0;
            quizScore = 0;
            renderExamQuestion();
        }

        function renderExamQuestion() {
            const content = document.getElementById('examContent');

            if (quizIndex >= quizQuestions.length) {
                const percent = Math.round((quizScore / quizQuestions.length) * 100);
                const passed = percent >= 80;

                content.innerHTML = `
                    <div class="content-card">
                        <h2>${passed ? '✅ Bestanden!' : '❌ Nicht bestanden'}</h2>
                        <div class="stat-box" style="margin: 30px 0;">
                            <div class="number" style="color: ${passed ? '#4CAF50' : '#f44336'}">${percent}%</div>
                            <div class="label">${quizScore} / ${quizQuestions.length} richtig</div>
                        </div>
                        <p style="margin: 20px 0; font-size: 1.1em;">
                            ${passed ? 'Herzlichen Glückwunsch! Du hast die Prüfung bestanden! 🎉' : 'Zum Bestehen werden 80% benötigt. Übe weiter! 💪'}
                        </p>
                        <button class="btn" onclick="startExam()">Erneut versuchen</button>
                        <button class="btn btn-secondary" onclick="showPage('cards')">Zurück zu Karten</button>
                    </div>
                `;
                return;
            }

            const q = quizQuestions[quizIndex].quiz;
            const progress = Math.round(((quizIndex + 1) / quizQuestions.length) * 100);

            let html = `
                <div class="content-card">
                    <h2>Prüfungsfrage ${quizIndex + 1}/${quizQuestions.length}</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <p style="font-size: 1.2em; margin: 25px 0; font-weight: 600;">${q.question}</p>
            `;

            q.answers.forEach((answer, i) => {
                html += `<button class="btn btn-secondary" onclick="checkAnswer(${i})">${answer}</button>`;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        // ==================== SEARCH ====================
        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const resultsDiv = document.getElementById('searchResults');

            if (!query) {
                resultsDiv.innerHTML = '<div class="content-card"><p>Gib einen Suchbegriff ein.</p></div>';
                return;
            }

            const results = cards.filter(c =>
                c.term.toLowerCase().includes(query) ||
                c.definition.toLowerCase().includes(query)
            );

            if (results.length === 0) {
                resultsDiv.innerHTML = `<div class="content-card"><p>Keine Ergebnisse für "${query}"</p></div>`;
                return;
            }

            let html = `<div class="content-card"><h2>${results.length} Ergebnis(se)</h2></div>`;
            results.forEach(c => {
                html += `
                    <div class="search-result">
                        <strong>${c.term}</strong>
                        ${c.definition}
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // ==================== PROGRESS ====================
        function saveProgress() {
            const today = new Date().toISOString().split('T')[0];
            let data = JSON.parse(localStorage.getItem('progress') || '{}');

            if (data.lastDate !== today) {
                data.todayCards = 1;
                data.lastDate = today;

                // Streak berechnen
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];

                if (data.lastDate === yesterdayStr) {
                    data.streak = (data.streak || 0) + 1;
                } else {
                    data.streak = 1;
                }
            } else {
                data.todayCards = (data.todayCards || 0) + 1;
            }

            data.totalCards = (data.totalCards || 0) + 1;

            localStorage.setItem('progress', JSON.stringify(data));
            loadProgress();
        }

        function loadProgress() {
            const data = JSON.parse(localStorage.getItem('progress') || '{}');

            document.getElementById('streakCount').textContent = data.streak || 5;
            document.getElementById('streakDays').textContent = data.streak || 5;
            document.getElementById('todayCards').textContent = data.todayCards || 12;
            document.getElementById('totalCards').textContent = data.totalCards || 247;

            const percent = Math.min(100, Math.round((data.totalCards || 247) / 500 * 100));
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
        }

        console.log('✅ App loaded - All features ready!');
    </script>
</body>
</html>
